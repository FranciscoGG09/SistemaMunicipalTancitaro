{"ast":null,"code":"import React,{createContext,useState,useContext,useEffect}from'react';import{authAPI}from'../services/api';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error('useAuth debe usarse dentro de un AuthProvider');}return context;};export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);useEffect(()=>{checkAuth();},[]);const checkAuth=async()=>{try{const token=localStorage.getItem('token');const userData=localStorage.getItem('user');if(token&&userData){// Verificar si el token es válido\nconst response=await authAPI.getProfile();setUser(response.data.usuario);}}catch(error){// Token inválido, limpiar localStorage\nlogout();}finally{setLoading(false);}};const login=async(email,password)=>{try{const response=await authAPI.login({email,password});const{token,usuario}=response.data;// Guardar en localStorage\nlocalStorage.setItem('token',token);localStorage.setItem('user',JSON.stringify(usuario));setUser(usuario);return{success:true,user:usuario};}catch(error){var _error$response,_error$response$data;const errorMessage=((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.error)||'Error de conexión';return{success:false,error:errorMessage};}};const logout=()=>{localStorage.removeItem('token');localStorage.removeItem('user');setUser(null);};const value={user,login,logout,loading,isAuthenticated:!!user,isAdmin:(user===null||user===void 0?void 0:user.rol)==='admin',isWorker:(user===null||user===void 0?void 0:user.rol)==='trabajador',isCitizen:(user===null||user===void 0?void 0:user.rol)==='ciudadano'};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","authAPI","jsx","_jsx","AuthContext","useAuth","context","Error","AuthProvider","_ref","children","user","setUser","loading","setLoading","checkAuth","token","localStorage","getItem","userData","response","getProfile","data","usuario","error","logout","login","email","password","setItem","JSON","stringify","success","_error$response","_error$response$data","errorMessage","removeItem","value","isAuthenticated","isAdmin","rol","isWorker","isCitizen","Provider"],"sources":["C:/Users/Franc/Documents/SistemaMunicipalTancitaro/frontend/src/context/AuthContext.jsx"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect } from 'react';\r\nimport { authAPI } from '../services/api';\r\n\r\nconst AuthContext = createContext();\r\n\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error('useAuth debe usarse dentro de un AuthProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    checkAuth();\r\n  }, []);\r\n\r\n  const checkAuth = async () => {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      const userData = localStorage.getItem('user');\r\n\r\n      if (token && userData) {\r\n        // Verificar si el token es válido\r\n        const response = await authAPI.getProfile();\r\n        setUser(response.data.usuario);\r\n      }\r\n    } catch (error) {\r\n      // Token inválido, limpiar localStorage\r\n      logout();\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const login = async (email, password) => {\r\n    try {\r\n      const response = await authAPI.login({ email, password });\r\n      const { token, usuario } = response.data;\r\n\r\n      // Guardar en localStorage\r\n      localStorage.setItem('token', token);\r\n      localStorage.setItem('user', JSON.stringify(usuario));\r\n      setUser(usuario);\r\n\r\n      return { success: true, user: usuario };\r\n    } catch (error) {\r\n      const errorMessage = error.response?.data?.error || 'Error de conexión';\r\n      return { success: false, error: errorMessage };\r\n    }\r\n  };\r\n\r\n  const logout = () => {\r\n    localStorage.removeItem('token');\r\n    localStorage.removeItem('user');\r\n    setUser(null);\r\n  };\r\n\r\n  const value = {\r\n    user,\r\n    login,\r\n    logout,\r\n    loading,\r\n    isAuthenticated: !!user,\r\n    isAdmin: user?.rol === 'admin',\r\n    isWorker: user?.rol === 'trabajador',\r\n    isCitizen: user?.rol === 'ciudadano'\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}